<!DOCTYPE html>
<html lang="en">
	<head>
		<title>study visu test</title>

		<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="modulkatalog02022015.js" charset="utf-8"></script>

		<style></style>

		<script>

			/*
			FWP: Fachwissenschaftliche Wahlpflichtfächer
			AWP: Allgemeinwissenschaftlichen Wahlpflichtfächern = AW?
			Anwendungsfach?
			SPOs neu alt?
			viele verschiedene "curriculum" Formulierungen?
			Abgleich mit Stundenplänen
			Anklicken im Standardverlauf was schon bestanden bzw. "einzeichnen" wann bspw. Zweitversuch
			wichtige Infos sichtbar wie Fächer-Abhängigkeiten, ECTS-"Deadlines", Auslands-ECTS etc.
			...
			*/
		/*
		var studiengaenge = [
            {
              "title": "Bachelor Informatik",
              "name": "IF Informatik Bachelor SPO Informatik",
              "type": "bachelor",
              "ects": "210",
              "regulation": "if19700101"
            },
            {
           	  "title": "Bachelor Informatik",
           	  "name": "IF Informatik Bachelor SPO Informatik 2012",
              "type": "bachelor",
              "ects": "210",
              "regulation": "if20121001"
            },
            {
              "title": "Master Informatik",
              "name": "IG Informatik Master SPO Informatik",
              "type": "master",
              "ects": "90",
              "regulation": "ig19700101"
            },            
            {
              "title": "Bachelor Wirtschaftsinformatik",
              "name": "IB Wirtschaftsinformatik Bachelor SPO Wirtschaftsinformatik",
              "type": "bachelor",
              "ects": "210",
              "regulation": "ib19700101"
            },            
            {
              "title": "Master Wirtschaftsinformatik",
              "name": "IN Wirtschaftsinformatik Master SPO Wirtschaftsinformatik",
              "type": "master",
              "ects": "90",
              "regulation": "in19700101"
            },            
            {
              "title": "Bachelor Scientific Computing",
              "name": "IC Scientific Computing Bachelor SPO Scientific Computing",
              "type": "bachelor",
              "ects": "210",
              "regulation": "ic19700101"
            },  
            {
              "title": "Bachelor Scientific Computing",
              "name": "IC Scientific Computing Bachelor SPO Scientific Computing 2012",
              "type": "bachelor",
              "ects": "210",
              "regulation": "ic20121001"
            },          
            {
              "title": "Master Stochastic Engineering",
              "name": "IS Stochastic Engineering in Business and Finance Master SPO Stochastic Engineering in Business and Finance",
              "type": "master",
              "ects": "90",
              "regulation": "is19700101"
            },
          ];
		*/

		var modules = data.modullist.modul;

	
			$(document).ready(function() {
				$('input[type="checkbox"]').click(function(){
					updateTable();
       			});

       			$('#suchfeld').on('input', function() {
    				updateTable();
				});

				updateTable();
			});


			function updateTable(){

				var searchTerm = $('#suchfeld').val();
				var allowedRegulations = new Array();

				/* DETERMINE STATE OF ALL CHECKBOXES */
				$('input[type="checkbox"]').each(function () {
					var id = $(this).attr('id');
					var idParts = id.split('_');
					var isChecked = $(this).prop('checked');
					if(isChecked){
						allowedRegulations.push(idParts[1]);
					}
				});
				console.log("allowed regulations: ")
				console.log(allowedRegulations);
				console.log("search term: " + searchTerm);

				/* DELETE OLD TABLE AND CONSTRUCT NEW ONE */
				$('#contentTableContainer').empty();
				var table = $('<table>').appendTo($('#contentTableContainer')).attr({
					'width' : '800',
					'id' : 'contentTable',
					'border' : '0',
					'align' : 'center'
				});
				var thead = $('<thead>').appendTo(table);
				var th;
				th = $('<th>').appendTo(thead).attr({
					'align' : 'left'
				});
				$(document.createTextNode('Titel')).appendTo(th); 
				th = $('<th>').appendTo(thead);
				$(document.createTextNode('Credits')).appendTo(th); 


				/* FILL THE TABLE WITH MATCHING DATA-ENTRIES */			
				var tr, td, content;
				for(var i = 0; i < modules.length; i++){
					var module = modules[i];

					if(isMatch(module, allowedRegulations, searchTerm)){
						tr = document.createElement('tr');	

						/* TITEL */
						td = document.createElement('td');
						td.appendChild(document.createTextNode(module.name));
						tr.appendChild(td);	
						table.append(tr);

						/* CREDITS */
						td = document.createElement('td');
						td.setAttribute('align', 'center');
						td.appendChild(document.createTextNode(module.credits));
						tr.appendChild(td);	
						table.append(tr);
					}
				}

			};

			function isMatch(module, allowedRegulations, searchTerm){
				var isMatch = true;
				
				/*TEST IF AT LEAST ONE OF THE ALLOWED REGULATIONS IS ASSIGNED TO THIS MODULE*/
				var hasAtLeastOne = false;
				for(var i = 0; i < allowedRegulations.length; i++){							
					var regulationToCheck = allowedRegulations[i];

					if(module.modulcodes != null){
						if(module.modulcodes.modulcode.length == null){
							if(module.modulcodes.modulcode.regulation != null){
								if(module.modulcodes.modulcode.regulation == regulationToCheck){
									hasAtLeastOne = true;
								}
							}
						} else {							
							for(var j = 0; j < module.modulcodes.modulcode.length; j++){
								var element = module.modulcodes.modulcode[j];
								if(element.regulation != null){
									if(element.regulation == regulationToCheck){
										hasAtLeastOne = true;
									}
								}
							}
						}
					}
				};
				isMatch = isMatch && hasAtLeastOne;

				/* CHECK IF SEARCH TERM IS CONTAINED IN THE NAME OF THE MODULE */
				if(isMatch && searchTerm.length > 0){
					if (module.name.toLowerCase().indexOf(searchTerm) >= 0){
						/* search term is contained in name of module */
					} else {
						isMatch = false;
					}
				}

				return isMatch;
			};

		</script>
	</head>
	<body>

		<br>
		
		<table align="center">
			<tr>
				<td>
					<input type="checkbox" id="studiengangCheckbox_if20121001" checked="checked">
				</td>
				<td>
					Bachelor Informatik
				</td>
				<td>
					&nbsp;&nbsp;&nbsp;
				</td>
				<td>
					<input type="checkbox" id="studiengangCheckbox_ig19700101" checked="checked">
				</td>
				<td>
					Master Informatik
				</td>
			</tr>
			<tr>
				<td>
					<input type="checkbox" id="studiengangCheckbox_ib19700101" checked="checked">
				</td>
				<td>
					Bachelor Wirtschaftsinformatik
				</td>
				<td>
					&nbsp;&nbsp;&nbsp;
				</td>
				<td>
					<input type="checkbox" id="studiengangCheckbox_in19700101" checked="checked">
				</td>
				<td>
					Master Wirtschaftsinformatik
				</td>
			</tr>
			<tr>
				<td>
					<input type="checkbox" id="studiengangCheckbox_ic20121001" checked="checked">
				</td>
				<td>
					Bachelor Scientific Computing
				</td>
				<td>
					&nbsp;&nbsp;&nbsp;
				</td>
				<td>
					<input type="checkbox" id="studiengangCheckbox_is19700101" checked="checked">
				</td>
				<td>
					Master Stochastic Engineering
				</td>
			</tr>
			<tr>
				<td colspan="5">&nbsp;&nbsp;&nbsp;</td>
			</tr>
			<tr>
				<td colspan="5">
					<center><input type="text" id="suchfeld" size="60"></center>
				</td>
			</tr>
		</table>

		<br>
		<br>
		<div id="contentTableContainer"></div>

	</body>
</html>